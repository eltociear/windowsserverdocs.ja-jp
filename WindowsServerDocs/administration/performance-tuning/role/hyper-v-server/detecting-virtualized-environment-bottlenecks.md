---
title: 仮想化環境でのボトルネックの検出
description: Hyper-v のパフォーマンスに関する潜在的なボトルネックを検出して解決する方法
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: asmahi; sandysp; jopoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 211f35c151e94bc8b8a11a614edad18053cb18b9
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80851782"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>仮想化環境でのボトルネックの検出

ここでは、パフォーマンスモニターを使用して監視する内容に関するヒントと、ホストまたは一部の仮想マシンが予期したとおりに動作しない場合に問題が発生する可能性がある場所を特定する方法について説明します。

## <a name="processor-bottlenecks"></a>プロセッサのボトルネック

ここでは、プロセッサのボトルネックを引き起こす可能性がある一般的なシナリオをいくつか紹介します。

-   1つ以上の論理プロセッサが読み込まれています

-   1つ以上の仮想プロセッサが読み込まれています

ホストから次のパフォーマンスカウンターを使用できます。

-   論理プロセッサ使用率-\\Hyper-v ハイパーバイザー論理プロセッサ (\*)\\合計実行時間の割合

-   仮想プロセッサ使用率-\\Hyper-v ハイパーバイザー仮想プロセッサ (\*)\\合計実行時間の割合

-   ルート仮想プロセッサ使用率-\\Hyper-v ハイパーバイザールート仮想プロセッサ (\*)\\合計実行時間の割合

**Hyper-v ハイパーバイザー論理プロセッサ (\_total)\\% Total Runtime**カウンターが90% を超えている場合、ホストは過負荷になります。 より多くの処理能力を追加するか、一部の仮想マシンを別のホストに移動する必要があります。

**Hyper-v ハイパーバイザー仮想プロセッサ (VM 名: VP x)\\% Total Runtime**カウンタがすべての仮想プロセッサに対して90% を超えている場合は、次の操作を行う必要があります。

-   ホストが過負荷になっていないことを確認する

-   ワークロードがより多くの仮想プロセッサを利用できるかどうかを確認する

-   仮想マシンにさらに仮想プロセッサを割り当てる

**Hyper-v ハイパーバイザー仮想プロセッサ (VM 名: VP x)\\% Total Runtime** counter が一部の仮想プロセッサでは90% を超えている場合は、次の操作を行う必要があります。

-   ワークロードがネットワークを集中的に使用する場合は、vRSS の使用を検討する必要があります。

-   仮想マシンで Windows Server 2012 R2 が実行されていない場合は、さらにネットワークアダプターを追加する必要があります。

-   ワークロードが記憶域を集中的に使用する場合は、仮想 NUMA を有効にし、さらに仮想ディスクを追加する必要があります。

**Hyper-v ハイパーバイザールート仮想プロセッサ (ルート VP x)\\% Total Runtime**カウンターが、一部ので90% を超えている場合、ただし、すべての仮想プロセッサと**プロセッサ (x)\\% Interrupt time と processor (x)\\% DPC time**カウンターの値が、**ルート仮想プロセッサ (ルート VP x)\\% Total Runtime** counter の値に約加算されているため、ネットワークアダプターで VMQ を有効にする必要があります。

## <a name="memory-bottlenecks"></a>メモリのボトルネック

次に、メモリのボトルネックの原因となる可能性がある一般的なシナリオをいくつか示します。

-   ホストが応答していません。

-   仮想マシンを起動できません。

-   仮想マシンのメモリが不足しています。

ホストから次のパフォーマンスカウンターを使用できます。

-   メモリ\\使用可能なメガバイト数

-   Hyper-v 動的メモリバランサー (\*)\\使用可能なメモリ

仮想マシンから次のパフォーマンスカウンターを使用できます。

-   メモリ\\使用可能なメガバイト数

**使用可能なメモリのメガバイト**数と**hyper-v 動的メモリバランサー (\*)\\の使用可能なメモリ**カウンターがホスト上で低い場合は、重要ではないサービスを停止し、1つまたは複数のバーチャルマシンを別のホストに移行する必要があり\\ます。

バーチャルマシンで**memory\\Available mb**カウンターが不足している場合は、バーチャルマシンにより多くのメモリを割り当てる必要があります。 動的メモリを使用する場合は、[最大メモリ] 設定を増やす必要があります。

## <a name="network-bottlenecks"></a>ネットワークのボトルネック

ネットワークのボトルネックを引き起こす可能性がある一般的なシナリオを次に示します。

-   ホストはネットワークにバインドされています。

-   仮想マシンはネットワークにバインドされています。

ホストから次のパフォーマンスカウンターを使用できます。

-   ネットワークインターフェイス (*ネットワークアダプター名*)\\バイト数/秒

仮想マシンから次のパフォーマンスカウンターを使用できます。

-   Hyper-v Virtual Network アダプター (*仮想マシン名&lt;GUID&gt;* )\\バイト/秒

**PHYSICAL NIC Bytes/sec**カウンタの容量が90% 以上の場合は、追加のネットワークアダプターを追加し、バーチャルマシンを別のホストに移行して、ネットワーク QoS を構成する必要があります。

**Hyper-v Virtual Network Adapter Bytes/sec**カウンターが 250 MBps 以上の場合は、追加のチーム化されたネットワークアダプターを仮想マシンに追加し、vRSS を有効にし、sr-iov を使用する必要があります。

ワークロードがネットワーク待機時間を満たせない場合は、SR-IOV を有効にして仮想マシンに物理ネットワークアダプターリソースを提示します。

## <a name="storage-bottlenecks"></a>記憶域のボトルネック

記憶域のボトルネックの原因となる一般的なシナリオをいくつか次に示します。

-   ホストおよびバーチャルマシンの操作が低速またはタイムアウトになっています。

-   仮想マシンの遅延が遅い。

ホストから次のパフォーマンスカウンターを使用できます。

-   物理ディスク (*ディスク文字*)\\の平均ディスク読み取り秒数

-   物理ディスク (*ディスク文字*)\\Avg. disk Sec/Write

-   物理ディスク (*ディスク文字*)\\ディスク読み取りキューの長さの平均

-   物理ディスク (*ディスク文字*)\\ディスク書き込みキューの長さの平均値

待機時間が常に50ミリ秒を超える場合は、次の操作を行う必要があります。

-   追加のストレージに仮想マシンを分散

-   高速ストレージの購入を検討する

-   Windows Server 2012 R2 で導入された Tiered Storage のスペースを検討してください。

-   Windows Server 2012 R2 で導入された記憶域 QoS の使用を検討してください。

-   VHDX を使用する

## <a name="see-also"></a>参照

-   [Hyper-V の用語](terminology.md)

-   [Hyper-V のアーキテクチャ](architecture.md)

-   [Hyper-V サーバーの構成](configuration.md)

-   [Hyper-V プロセッサのパフォーマンス](processor-performance.md)

-   [Hyper-V メモリのパフォーマンス](memory-performance.md)

-   [Hyper-V 記憶域の I/O のパフォーマンス](storage-io-performance.md)

-   [Hyper-V ネットワークの I/O のパフォーマンス](network-io-performance.md)

-   [Linux 仮想マシン](linux-virtual-machine-considerations.md)
